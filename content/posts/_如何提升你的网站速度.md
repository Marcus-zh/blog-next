---
title: å¦‚ä½•æå‡ä½ çš„ç½‘ç«™é€Ÿåº¦
categories:
  - ç»éªŒåˆ†äº«
tags:
  - CDN
  - SWPP
description: å¦‚ä½•æå‡ä½ çš„ç½‘ç«™é€Ÿåº¦
keywords: 'cdn,swpp,åŠ é€Ÿ,æé€Ÿ'
abbrlink: 5a1df3f8
date: 2023-09-01 13:05:41
updated:
cover: https://img2.marcus233.top/25/02/ca797b9bccbf9f62.png
top_group_index:
tcolor: 1A5F25
---
æœ€è¿‘åœ¨ç¾¤é‡Œçœ‹è§å¾ˆå¤šå°ä¼™ä¼´çš„ç½‘ç«™æ‰“å¼€éƒ½å¾ˆæ…¢

ä¸€åˆ†é’Ÿä¹‹å†…æ‰“ä¸å¼€é¦–å±

ä¹Ÿå°±å¯¼è‡´å¾ˆå¤šç«™çš„ä½“éªŒéå¸¸æ»´å·®

(æŸäº›é­”æ”¹åªæŠ„ä¸æ”¹çš„,èµ„æºå¤±æ•ˆäº†éƒ½æ²¡å‘ç°,è¿˜æ•´å‡ ä¸ªå¤§çº¢ç¯ç¬¼æ¬¢è¿è°å‘¢)

æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä¼šæä¾›`2`ç§æ–¹æ¡ˆæ¥ä¼˜åŒ–ä½ çš„ç½‘ç«™çš„åŠ è½½é€Ÿåº¦

<!-- more -->

## ç¬¬ä¸€ç§(CDN)

æœ‰å¾ˆå¤šåŒå­¦çš„åšå®¢æ˜¯æ”¾åœ¨[vercel](vercel.com)æˆ–è€…æ˜¯[Github Pages](GitHub.com)ä¸Šçš„

å› ä¸ºæŸäº›ä¼—æ‰€å‘¨çŸ¥çš„åŸå› å˜›

æ‰€ä»¥æˆ‘å‘å¤§å®¶æ¨èä¸€ä¸‹ä¸¤ç§CDN(ç¾¤å‹è¿è¥çš„,å®‰å…¨å¯é )

### åˆæŸ“äº‘

[åˆæŸ“äº‘](https://cloud.firstdyeing.com/aff/HIXZJHFB)

åˆæŸ“äº‘æ˜¯æˆ‘ä»¬Acrylicçš„èµåŠ©å•†

éå¸¸æ¨è

æœåŠ¡å™¨2h2g,ä¸€æœˆåªéœ€`25`

è¿˜æœ‰`38.8`ä¸€æ¡é¾™æœåŠ¡

![ä¸€æ¡é¾™æœåŠ¡](https://img01.anheyu.com/useruploads/8/2023/08/27/64eb1ac0c40a7.jpeg)

### åˆä¸ƒäº‘

[åˆä¸ƒäº‘](https://www.chuqiyun.com/aff/UTPYFQYG)

åˆä¸ƒèµ°æˆ‘é“¾æ¥çš„è¯ä¼šé€`ä¸ªäººç‰ˆä¸€ä¸ªæœˆ`

å¦å¤–è¯´ä¸€ä¸‹,åˆä¸ƒææ´»åŠ¨
ecs 5 æŠ˜ä¸“åŒº
ECS-æ—¥æœ¬è½¯é“¶çº¿è·¯å·²ä¸Šæ¶ï¼Œ5æŠ˜éª¨æŠ˜ç ï¼šecs-jp
ECS-ç¾å›½çº¿è·¯ï¼ŒCç»„ 5æŠ˜éª¨æŠ˜ç ï¼šecs-la

å…ˆåˆ°å…ˆå¾—

### å¦å¤–

éš”å£é›¨äº‘åå‘¨å¹´æ´»åŠ¨

2h2gæœ€ä½åªéœ€`12`

![é›¨äº‘](https://img01.anheyu.com/useruploads/8/2023/08/27/64eb1b83bb5ae.png)

### è¡¥å……

vercel+cdnå¯ä»¥çœ‹[é±¼é±¼çš„è¿™ç¯‡æ–‡ç« ](https://blog.anheyu.com/posts/136a.html)

å¦‚æœæ²¡æœ‰å……è¶³çš„èµ„é‡‘æ

## ç¬¬äºŒç§(SWPPåŠ é€Ÿ)

### ä»‹ç»
swpp-backendsæ’ä»¶çš„åŠŸèƒ½æ˜¯ä¸ºç½‘ç«™ç”Ÿæˆä¸€ä¸ªé«˜åº¦å¯ç”¨çš„ ServiceWorkerï¼Œä¸ºç½‘ç«™ä¼˜åŒ–äºŒæ¬¡åŠ è½½ã€æä¾›ç¦»çº¿ä½“éªŒã€æé«˜å¯é æ€§ï¼Œå¹¶ä¸ºæ­¤é™„å¸¦äº†ä¸€äº›å…¶å®ƒçš„åŠŸèƒ½ã€‚

### å®‰è£…

```shell
npm install --save swpp-backends hexo-swpp
```

### ä½¿ç”¨

anzhiyuä¸»é¢˜ä¸‹è½½åå¼€å¯é…ç½®é¡¹å³å¯

å…¶ä»–ä¸»é¢˜å¯ä»¥åœ¨åšå®¢æ ¹ç›®å½•æˆ–è€…ä¸»é¢˜æ ¹ç›®å½•åˆ›å»º`sw-rule.js`

å†…å®¹å¦‚ä¸‹,éœ€è‡ªå·±æ›´æ”¹

```js
/*
see https://kmar.top/posts/b70ec88f/
and https://kmar.top/posts/73014407/
*/
module.exports.config = {
  serviceWorker: {
      escape: 0,
      cacheName: 'MarcusBlogCache'
  },
  register: {
      onsuccess: () => console.log("Service Worker æ³¨å†ŒæˆåŠŸï¼"),
      onerror: () => GLOBAL_CONFIG.Snackbar !== undefined && mar.snackbarShow('Service Worker æ³¨å†Œå¤±è´¥ï¼å¯èƒ½æ˜¯ç”±äºæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯¥åŠŸèƒ½ï¼'),
      builder: (root, framework, pluginConfig) => {
        const registerConfig = pluginConfig.register
        const {onerror, onsuccess} = registerConfig
        return `<script>
            (() => {
                let sw = navigator.serviceWorker
                let error = ${onerror.toString()}
                if (!sw?.register('${new URL(root).pathname}sw.js')
                    ${onsuccess ? '?.then(' + onsuccess.toString() + ')' : ''}
                    ?.catch(error)
                ) error()
            })()
        </script>`
      }
  },
  dom: {
    onsuccess: () => {
      caches.match('https://id.v3/').then(function(response) {
        if (response) {
          // å¦‚æœæ‰¾åˆ°äº†åŒ¹é…çš„ç¼“å­˜å“åº”
          response.json().then(function(data) {
            GLOBAL_CONFIG.Snackbar !== undefined && mar.snackbarShow('é€šçŸ¥ğŸ“¢', `å·²åˆ·æ–°ç¼“å­˜ï¼Œæ›´æ–°ä¸º${data.global + "." + data.local}ç‰ˆæœ¬æœ€æ–°å†…å®¹`);
          });
        } else {
          console.info('æœªæ‰¾åˆ°åŒ¹é…çš„ç¼“å­˜å“åº”');
        }
      }).catch(function(error) {
        console.error('ç¼“å­˜åŒ¹é…å‡ºé”™:', error);
      });
    },
  },
  json: {
      maxHtml: 15,
      charLimit: 1024,
      precisionMode: {
          default: false
      },
      merge: [],
      exclude: [ /sw\.js$/ ]
  },
  external: {
      timeout: 10000,
      js: [
        {
          head: "getScript\(",
          tail: "\)",
        },
      ],
      skip: [],
      replace: [
        {
          source: ["cdn.jsdelivr.net","cdnjs.cloudflare.com","cdn1.tianli0.top"],
          dist: "cdn.chuqis.com",
        },
        {
          source: ["unpkg.com"],
          dist: "npm.elemecdn.com"
        }
      ],
  },
  sort: { 
    keywords: false,
  }
}
module.exports.cacheRules = {
  simple: {
    clean: true,
    search: false,
    match: (url, $eject) => {
      const allowedHost = $eject.domain;
      return url.host === allowedHost && url.pathname.match(/\.(woff2|woff|ttf|cur)$/)
    }
    },
  cdn: {
    clean: true,
    match: url =>
      [
        "cdn.cbd.int",
        "lf26-cdn-tos.bytecdntp.com",
        "lf6-cdn-tos.bytecdntp.com",
        "lf3-cdn-tos.bytecdntp.com",
        "lf9-cdn-tos.bytecdntp.com",
        "cdn.staticfile.org",
        "npm.elemecdn.com",
        "jsd.onmicrosoft.cn",
        "cdn.chuqis.com",
      ].includes(url.host) && url.pathname.match(/\.(js|css|woff2|woff|ttf|cur)$/),
  },
};
// module.exports.getRaceUrls = srcUrl => {
//     if (srcUrl.startsWith('https://npm.elemecdn.com')) {
//         const url = new URL(srcUrl)
//         return [
//             srcUrl,
//             `https://jsd.moezz.cn/npm` + url.pathname,
//             `https://jsd.onmicrosoft.cn/npm` + url.pathname,
//             `https://cdn.chuqis.com/npm` + url.pathname
//         ]
//     }
// }
module.exports.getSpareUrls = srcUrl => {
    if (srcUrl.startsWith('https://cdn.chuqis.com')) {
        return {
            timeout: 3000,
            list: [
                srcUrl,
                `https://jsd.onmicrosoft.cn/${new URL(srcUrl).pathname}`
            ]
        }
    }
}
module.exports.ejectValues = (hexo) => {
  return {
      domain: {
          prefix: 'const',
          value: new URL(hexo.config.url).host
      }
  }
}
```

é™„ä¸Šæ–‡æ¡£é“¾æ¥

[Swpp-Backends](https://kmar.top/posts/b70ec88f/)

[Hexo-Swpp](https://github.com/EmptyDreams/hexo-swpp#readme)
